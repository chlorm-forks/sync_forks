#!/usr/bin/env sh

# Current directory is used as the working directory
workDir=$(pwd)

upstream_url () {

	case $upstreamRepoVcs in
		'bazaar')
			case $remoteRepoLocation in
				'')
					echo ""
					;;
				*)
					echo "ERROR: invalid remote repo location: $remoteRepoLocation" >> sync_fork.errors
					return 1
					;;
			esac
			;;
		'cvs')
			case $remoteRepoLocation in
				'')
					echo ""
					;;
				*)
					echo "ERROR: invalid remote repo location: $remoteRepoLocation" >> sync_fork.errors
					return 1
					;;
			esac
			;;
		'darcs')
			case $remoteRepoLocation in
				'')
					echo ""
					;;
				*)
					echo "ERROR: invalid remote repo location: $remoteRepoLocation" >> sync_fork.errors
					return 1
					;;
			esac
			;;
		'git')
			case $remoteRepoLocation in
				'blicky')
					echo "git://g.blicky.net"
					;;
				'github')
					echo "git@github.com:$accountName"
					;;
				'googlecode')
					echo "git://code.google.com"
					;;
				'googlesource')
					echo "git://$projectName.googlesource.com/$accountName"
					;;
				'videolan')
					echo "git://git.videolan.org"
					;;
				*)
					echo "ERROR: invalid remote repo location: $remoteRepoLocation" >> sync_fork.errors
					return 1
					;;
			esac
			;;
		'hg')
			case $remoteRepoLocation in
				'bitbucket')
					echo "https://bitbucket.org/$accountName"
					;;
				*)
					echo "ERROR: invalid remote repo location: $remoteRepoLocation" >> sync_fork.errors
					return 1
					;;
			esac
			;;
		'svn')
			case $remoteRepoLocation in
				'')
					echo ""
					;;
				*)
					echo "ERROR: invalid remote repo location: $remoteRepoLocation" >> sync_fork.errors
					return 1
					;;
			esac
			;;
		*)
			echo "ERROR: invalid remote repo vcs: $upstreamRepoVcs" >> sync_fork.errors
			;;
	esac

}

sync_fork () {

	upstreamRepoVcs="${1}"
	remoteRepoLocation="${2}"
	repoName="${3}"
	accountName="${4}"
	projectName="${5}"

	cd "$workDir"

	git clone git@github.com:chlorm-forks/"${repoName}".git
	cd ${repoName}


	# Check to see if repo has a remote upstream set
	checkForUpstreamRemote=$(git remote | grep 'upstream' > /dev/null)
	# If not, add upstream remote
	if [ -z "$checkForUpstreamRemote" ]; then
		git remote add upstream "$(upstream_url)"/"${repoName}".git || \
		{ echo "$(date '+%F %R') ERROR: failed to add upstream remote to $repoName.git" >> sync_fork.errors ; }
	fi

	# Check to see if the upstream repo still exists
	case $upstreamRepoVcs in
		'bazaar')
			echo
			;;
		'cvs')
			echo
			;;
		'darcs')
			echo
			;;
		'git')
			git ls-remote --exit-code upstream
			# If not, nothing to do
			if test $? = 2; then
				echo "ERROR: $repoName upstream unreachable" >> sync_fork.errors
			fi
			;;
		'hg')
			echo
			;;
		'svn')
			echo
			;;
	esac

	git fetch upstream

	git pull upstream master

	git push origin master

	cd $workDir

	if [ -d "$repoName" ]; then
		rm -rf ${repoName}/
	fi

}

# Blicky (git)
#sync_fork git blicky ncdc
#sync_fork git blicky ncdu

# Bitbucket (git)

# Bitbucket (hg)
#sync_fork hg bitbucket x265 multicoreware

# Github (git)
sync_fork git github atlas Netflix
sync_fork git github beets sampsyo
sync_fork git github bgpanel warhawk3407
sync_fork git github blackfriday russross
sync_fork git github bone squiidz
sync_fork git github btree google
sync_fork git github cache2go rif
sync_fork git github calamari ceph
sync_fork git github cdnstats antage
sync_fork git github ceph ceph
sync_fork git github chub vchimishuk
sync_fork git github codeworld google
sync_fork git github consul hashicorp
sync_fork git github consul-alerts AcalephStorage
sync_fork git github CoverflowAltTab dmo60
sync_fork git github cpu jpoirier
sync_fork git github deepboost google
sync_fork git github dl nf
sync_fork git github donut dforsyth
sync_fork git github eiskaltdcpp eiskaltdcpp
sync_fork git github entomonitor droundy
sync_fork git github env darkhelmet
sync_fork git github esoTalk esotalk
sync_fork git github evil-icons outpunk
sync_fork git github ffmpeg-mr tstordyallison
sync_fork git github flac.js audiocogs
sync_fork git github Flat-UI designmodo
sync_fork git github flowplayer flowplayer
sync_fork git github fnd xarg
sync_fork git github fsnotify howeyc
sync_fork git github fuse bazillion
sync_fork git github Gentoo_Portage_com mikevalstar
sync_fork git github github-buttons mdo
sync_fork git github gmusicbrowser squentin
sync_fork git github gnome-shell-extension-battery_status milliburn
sync_fork git github gnome-shell-headphone-indicator mengzhuo
sync_fork git github gnome-shell-remove-dropdown-arrows mpdeimos
sync_fork git github go.tftp brooksbp
sync_fork git github go-fuse hanwen
sync_fork git github go-github google
sync_fork git github go-libpq jgallagher
sync_fork git github go-pgsql lxn
sync_fork git github go-systemd ehmry
sync_fork git github go-taglib wtolson
sync_fork git github go-tpm google
sync_fork git github go-webdav
sync_fork git github go-xmpp mattn
sync_fork git github gocurse jabb
sync_fork git github gocurses tncardoso
sync_fork git github gogs gogits
sync_fork git github GoHM rainliu
sync_fork git github gohttptun nf
sync_fork git github gompd fhs
sync_fork git github goobox GNOME
sync_fork git github goplayer nf
sync_fork git github gopp skelterjohn
sync_fork git github goriakpbc tpjg
sync_fork git github goto nf
sync_fork git github GoVisa rainliu
sync_fork git github gowiki jmoiron
sync_fork git github gowiki-mux adred
sync_fork git github grong bortzmeyer
sync_fork git github hesokuri google
sync_fork git github htop hishamhm
sync_fork git github httprouter julienschmidt
sync_fork git github hugo spf13
sync_fork git github hydra NixOS
sync_fork git github identity-toolkit-go-client
sync_fork git github influxdb influxdb
sync_fork git github iothrottler
sync_fork git github LaTeXTools SublimeText
sync_fork git github lhnb liskin
sync_fork git github lime limetext
sync_fork git github malus distributed
sync_fork git github MarkdownEditing SublimeText-Markdown
sync_fork git github Metro-UI-CSS olton
sync_fork git github mpDris2 eonpatapon
sync_fork git github Music-Integration brianrobles204
sync_fork git github Music-LastFM riemann42
sync_fork git github Music-Tag riemann42
sync_fork git github Music-Tag-Amazon riemann42
sync_fork git github Music-Tag-File riemann42
sync_fork git github Music-Tag-FLAC riemann42
sync_fork git github Music-Tag-LyricsFetcher riemann42
sync_fork git github Music-Tag-M4A riemann42
sync_fork git github Music-Tag-MP3 riemann42
sync_fork git github Music-Tag-MusicBrainz riemann42
sync_fork git github Music-Tag-OGG riemann42
sync_fork git github MusicFS thereapman
sync_fork git github mysqlenv shim0mura
sync_fork git github netsnail PerArneng
sync_fork git github nix NixOS
sync_fork git github nixos NixOS
sync_fork git github nixos-artwork NixOS
sync_fork git github nixpkgs NixOS
sync_fork git github NodeBB NodeBB
sync_fork git github oggflacblock imalone
sync_fork git github open-location-code google
sync_fork git github opencompute facebookarchive
sync_fork git github os measure
sync_fork git github osquery facebook
sync_fork git github paramgmt google
sync_fork git github perl-audio-flac-header
sync_fork git github pgsql.go jbarham
sync_fork git github pgsql-utils snaga
sync_fork git github pgsqlenv yutakat
sync_fork git github pgx jackc
sync_fork git github picard musicbrainz
sync_fork git github picard-plugins musicbrainz
sync_fork git github pickup werkshy
sync_fork git github PostgresApp PostgresApp
sync_fork git github PowerShell SublimeText
sync_fork git github pq lib
sync_fork git github pull-request-mailer google
sync_fork git github pulsego moriyoshi
sync_fork git github pure yahoo
sync_fork git github reddit reddit
sync_fork git github revel revel
sync_fork git github rfc mislav
sync_fork git github riak basho
sync_fork git github riako jkassemi
sync_fork git github rsync julian-gutierrez-o
sync_fork git github rutorrent-auto-installer-centos etiennerached
sync_fork git github salt saltstack
sync_fork git github Semantic-UI Semantic-Org
sync_fork git github slap slap-editor
sync_fork git github snappy google
sync_fork git github split2flac ftrvxmtrx
sync_fork git github supler softwaremill
sync_fork git github syncthing syncthing
sync_fork git github theory ralfonso
sync_fork git github tigertree udoprog
sync_fork git github U-232-V3 Bigjoos
sync_fork git github uhub janvidar
sync_fork git github video.js videojs
sync_fork git github wav nf
sync_fork git github wcld ryandotsmith
sync_fork git github wgo royger
sync_fork git github what-cd-scripts gmcabrita
sync_fork git github xsecurelock google
sync_fork git github ympd notandy
sync_fork git github yoink phracker

# Google Code (git)

# Google Code (hg)

# Google Code (svn)

# Google Source (git)

# Videolan (git)